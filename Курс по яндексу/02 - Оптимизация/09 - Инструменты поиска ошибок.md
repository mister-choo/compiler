# –î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ–∏—Å–∫–∞ –æ—à–∏–±–æ–∫

–ë–æ–ª—å—à–∞ÃÅ—è —á–∞—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ ‚Äî –ø–æ–∏—Å–∫ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫. –≠—Ç–∞ —Ä–∞–±–æ—Ç–∞ —Å—Ä–∞–≤–Ω–∏–º–∞ —Å —Ä–∞–±–æ—Ç–æ–π —Å—ã—â–∏–∫–∞ ‚Äî –≤–µ–¥—å –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é –ø—Ä–æ–≥—Ä–∞–º–º—ã —á–∞—Å—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç —á–µ—Ä–µ–¥–∞ –∑–∞–ø—É—Ç–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π. –ò –≤–∞—à–∞ –∑–∞–¥–∞—á–∞ —Ä–∞—Å–ø—É—Ç–∞—Ç—å –∏—Ö, –Ω–∞–π—Ç–∏ ¬´–ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∞¬ª ‚Äî –±–∞–≥, –∞ –∑–∞—Ç–µ–º –æ–±–µ–∑–≤—Ä–µ–¥–∏—Ç—å –µ–≥–æ. –í—ã —É–∂–µ –∑–∞–Ω–∏–º–∞–ª–∏—Å—å —ç—Ç–∏–º –≤ —Ç–µ–º–µ –æ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏. –í –¥–∞–Ω–Ω–æ–π —Ç–µ–º–µ —Ä–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ–º–æ–≥—É—Ç –≤–∞–º —Å–æ–±—Ä–∞—Ç—å —É–ª–∏–∫–∏ –∏ —Å—Ç–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–º –®–µ—Ä–ª–æ–∫–æ–º –•–æ–ª–º—Å–æ–º –≤ –º–∏—Ä–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.

C++ –æ—Ç–ª–∏—á–Ω–æ —É–º–µ–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å –æ—à–∏–±–∫–∏ –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –≠—Ç–æ —Å–≤–æ–π—Å—Ç–≤–æ —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —è–∑—ã–∫–æ–≤ ‚Äî —Ç–æ –µ—Å—Ç—å —Ç–∞–∫–∏—Ö, –≥–¥–µ, –æ–±—ä—è–≤–ª—è—è –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∏–ø–∞ `string`, –≤—ã –∑–∞—Ç–µ–º –Ω–µ –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å –≤ –Ω–µ—ë —á–∏—Å–ª–æ. –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ –≤–ª–∏—è–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã, –Ω–æ –∏ –Ω–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤—ã—è–≤–ª—è—Ç—å –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.

–ß–µ–º —Ä–∞–Ω—å—à–µ –≤—ã—è–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞, —Ç–µ–º –ø—Ä–æ—â–µ –±—É–¥–µ—Ç –Ω–∞–π—Ç–∏ –µ—ë –ø—Ä–∏—á–∏–Ω—É –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å. –ê –≥–ª–∞–≤–Ω–æ–µ, –æ—à–∏–±–∫–∞ –Ω–µ —É—Å–ø–µ–µ—Ç –Ω–∞–¥–µ–ª–∞—Ç—å –ø–∞–∫–æ—Å—Ç–µ–π. –í—ã—è–≤–∏—Ç—å –µ—ë –Ω–∞ —Ç–∞–∫–æ–º —Ä–∞–Ω–Ω–µ–º —ç—Ç–∞–ø–µ –∫–∞–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏—è ‚Äî –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ.

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ –æ—Ä–∞–∫—É–ª, –∏ –Ω–∞–π–¥—ë—Ç –¥–∞–ª–µ–∫–æ –Ω–µ –≤—Å–µ –æ—à–∏–±–∫–∏. –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –±–∞–≥–æ–≤ —Å—É—â–µ—Å—Ç–≤—É—é—Ç —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã. –ù–æ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –ø–∏—à—É—Ç –ª—é–¥–∏, –∞ —á–µ–ª–æ–≤–µ–∫ –º–æ–∂–µ—Ç –∑–∞–±—ã—Ç—å —á—Ç–æ-–Ω–∏–±—É–¥—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å. –î–∞–∂–µ –æ–ø—ã—Ç–Ω—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–¥–µ–ª–∞—Ç—å —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞–º–∏, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—â–µ–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –ø—Ä–æ–≥—Ä–∞–º–º—ã.

üìñ –ì–∞—Ä–∞–Ω—Ç–∏—é –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –º–æ–∂–µ—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Ñ–æ—Ä–º–∞–ª—å–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è. –≠—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –Ω–æ–≤–æ–µ –∏ –∫—Ä–∞–π–Ω–µ —Å–ª–æ–∂–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∞ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–æ–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤. –í –º–∏—Ä–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏—à—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ø—Ä–æ–≥—Ä–∞–º–º, –æ–¥–Ω–∞ –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö ‚Äî –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä CompCert C.

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ—à–ª–∞ —Å–∏—Ç–æ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ –∏ —Å–∏—Ç–æ —é–Ω–∏—Ç —Ç–µ—Å—Ç–æ–≤, —Ç–æ –≤—ã—è–≤–∏—Ç—å –µ—ë –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã. –ü—Ä–∏—á—ë–º —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ –Ω—É–∂–Ω–æ –∫–∞–∫ –º–æ–∂–Ω–æ —Ä–∞–Ω—å—à–µ, –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ –±–∞–≥, –∫–∞–∫ –∏ –ø—Ä–µ—Å—Ç—É–ø–Ω–∏–∫–∞, –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ –ª–æ–≤–∏—Ç—å –ø–æ –≥–æ—Ä—è—á–∏–º —Å–ª–µ–¥–∞–º. –û—à–∏–±–∫–∞, –≤—ã—è–≤–ª–µ–Ω–Ω–∞—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

C++ —Å—á–∏—Ç–∞—é—Ç —Å–ª–æ–∂–Ω—ã–º —è–∑—ã–∫–æ–º, –∏ –æ–¥–Ω–∞ –∏–∑ –ø—Ä–∏—á–∏–Ω ‚Äî —Å–ª–∞–±—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –æ—à–∏–±–æ–∫ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –ù–æ —ç—Ç–æ–º—É –µ—Å—Ç—å –æ–ø—Ä–∞–≤–¥–∞–Ω–∏–µ ‚Äî –ø—Ä–∏–Ω—Ü–∏–ø –Ω—É–ª–µ–≤–æ–≥–æ –æ–≤–µ—Ä—Ö—ç–¥–∞:

> **–ü—Ä–∏–Ω—Ü–∏–ø –Ω—É–ª–µ–≤–æ–≥–æ –æ–≤–µ—Ä—Ö–µ–¥–∞**
> 
> –ö–æ–¥ –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–≤–µ—Ä—à–∞—Ç—å –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –µ–≥–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–¥–∞—á–∏.

–≠—Ç–æ—Ç –ø—Ä–∏–Ω—Ü–∏–ø –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ C++ –∏ –≤ —Ü–µ–ª–æ–º –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞. –ö–æ–Ω—Ç—Ä–æ–ª—å –æ—à–∏–±–æ–∫ –Ω–µ –Ω—É–∂–µ–Ω, –µ—Å–ª–∏ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ –Ω–µ—Ç –æ—à–∏–±–æ–∫. –ê –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å, —ç—Ç–æ –≤–∏–Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞, –Ω–æ –Ω–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞. –ü–æ—ç—Ç–æ–º—É –≤–æ –º–Ω–æ–≥–∏—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö, –º–µ—Ç–æ–¥–∞—Ö –∏ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö C++ –∫–æ–Ω—Ç—Ä–æ–ª—å –æ—à–∏–±–æ–∫ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é.

üìñ –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–≤–±–æ–∏ –Ω–∞ –î–∏–∫–æ–º –∑–∞–ø–∞–¥–µ –Ω–æ—Å–∏–ª–∏ —Ä–µ–≤–æ–ª—å–≤–µ—Ä —É–∂–µ –≤–∑–≤–µ–¥—ë–Ω–Ω—ã–º. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–ª–æ —Å–æ–≤–µ—Ä—à–∏—Ç—å –≤–Ω–µ–∑–∞–ø–Ω—ã–π –≤—ã—Å—Ç—Ä–µ–ª –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ. –ù–æ –º–∞–ª–µ–π—à–∞—è –Ω–µ–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å –º–æ–≥–ª–∞ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –¥—ã—Ä–∫–µ –≤ –Ω–æ–≥–µ —Å–∞–º–æ–≥–æ —Å—Ç—Ä–µ–ª–∫–∞. –¢–∞–∫ –∂–µ –∏ –≤ C++, –≥–¥–µ —Å–∫–æ—Ä–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º ‚Äî –Ω–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç. –ò–Ω–æ–≥–¥–∞ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –∑–∞ —Å—á—ë—Ç –æ—Å–ª–∞–±–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª—è. –ò –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã –º–æ–∂–µ—Ç–µ —Å –ª—ë–≥–∫–æ—Å—Ç—å—é –≤—ã—Å—Ç—Ä–µ–ª–∏—Ç—å —Å–µ–±–µ –≤ –Ω–æ–≥—É.


# –°–∫—Ä—ã—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏

–û—à–∏–±–∫–∏ –±—ã–≤–∞—é—Ç –æ—á–µ–Ω—å –∫–æ–≤–∞—Ä–Ω—ã. –í–Ω–∞—á–∞–ª–µ –æ–Ω–∏ –ø—Ä—è—á—É—Ç—Å—è, –∞ –ø–æ—Ç–æ–º –≤—ã—Å–∫–∞–∫–∏–≤–∞—é—Ç –≤ —Å–∞–º—ã–π –Ω–µ—É–¥–æ–±–Ω—ã–π –º–æ–º–µ–Ω—Ç. –í —ç—Ç–æ–º —É—Ä–æ–∫–µ –ø–æ–ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –∏ –æ–±–µ–∑–≤—Ä–µ–¥–∏—Ç—å –æ—à–∏–±–∫—É —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ç–∞–∫–æ–π –∫–æ–¥ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–≥–æ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ —á–∏—Å–ª–æ–≤–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞:


```cpp

#include <iostream>
#include <vector>

using namespace std;

template <class T>
double mean(const std::vector<T>& v) {
    T acc;

    for (size_t i = 0; i <= v.size(); ++i) {
        acc += v[i];
    }

    return static_cast<double>(acc) / v.size();
}

int main() {
    vector<double> u = {1, 2, 3, 4, 5};
    cout << "Mean: "s << mean(u) << endl;
} 

```

–°–æ—Ö—Ä–∞–Ω–∏–º —ç—Ç–æ—Ç –∫–æ–¥ –≤ —Ñ–∞–π–ª `mean.cpp`. –ë—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É, –ø–æ—Å–∫–æ–ª—å–∫—É –≤ —ç—Ç–æ–π —Ç–µ–º–µ –≤–∞–º –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç –º–Ω–æ–≥–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–µ–π. –°–∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º –∏ –∑–∞–ø—É—Å—Ç–∏–º –ø—Ä–æ–≥—Ä–∞–º–º—É:


```cpp

> g++ mean.cpp -o mean
> ./mean
Mean: 3 

```

–¢–∞–∫ –º—ã –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º –Ω–∞ UNIX-—Å–∏—Å—Ç–µ–º–∞—Ö, –ø–æ–¥ Windows –º—ã –∑–∞–ø—É—Å–∫–∞–ª–∏ –±—ã –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–æ—â–µ:


```cpp

> g++ mean.cpp -o mean
> mean
Mean: 3 

```

–ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–¥–∞–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç. –ü–æ—Å–º–æ—Ç—Ä–∏–º, –æ–∑–Ω–∞—á–∞–µ—Ç –ª–∏ —ç—Ç–æ, —á—Ç–æ –≤ –Ω–µ–π –Ω–µ—Ç –æ—à–∏–±–æ–∫. –ü–æ–ø—Ä–æ–±—É–µ–º –¥—Ä—É–≥–æ–π –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä ‚Äî Clang. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –µ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –±—É–¥—É—Ç –≤ –æ–¥–Ω–æ–º –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —É—Ä–æ–∫–æ–≤.


```cpp

> clang++ mean.cpp -o mean
> ./mean
Mean: -nan 

```

–ü–æ–¥ Windows –±—ã–ª –±—ã —Ç–∞–∫–æ–π –∫–æ–¥:


```cpp

> clang++ mean.cpp -o mean.exe
> mean
Mean: -nan 

```

–ö–∞–∫ –≤–∏–¥–∏–º, —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ –¥—Ä—É–≥–æ–π ‚Äî –ø–æ–ª—É—á–∏–ª–æ—Å—å –æ—Å–æ–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –¥–∞–∂–µ –Ω–µ —á–∏—Å–ª–æ. –ó–Ω–∞—á–∏—Ç, –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ –µ—Å—Ç—å –æ—à–∏–±–∫–∏, –∏ –≤—ã—è–≤–∏—Ç—å –∏—Ö –ø—Ä–æ—Å—Ç—ã–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å g++ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å..

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –Ω–µ –ø–æ–ª—å–∑—É–µ–º—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏, –ø–æ—ç—Ç–æ–º—É –æ—Å—Ç–∞—ë—Ç—Å—è –æ–¥–Ω–æ ¬´‚Äé–Ω–∞—Ä–æ–¥–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ¬ª‚Äé ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –≤—ã–≤–æ–¥—ã –≤ –∫–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã. –û–Ω–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–≤–æ–¥–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã. –¢–∞–∫ –º—ã –ø–æ–π–º—ë–º, –≤ –∫–∞–∫–æ–π –º–æ–º–µ–Ω—Ç —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫.


```cpp

template <class T>
double mean(const std::vector<T>& v) {
    T acc;

    for (size_t i = 0; i <= v.size(); ++i) {
        acc += v[i];
        cout << "v["s << i << "] = "s << v[i] << endl;
        cout << "acc: "s << acc << endl;
    }

    return static_cast<double>(acc) / v.size();
} 

```

–ó–∞–ø—É—Å—Ç–∏–º –ø—Ä–æ–≥—Ä–∞–º–º—É –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ –≤—ã–≤–æ–¥:


```cpp

Mean: v[0] = 1
acc: 1
v[1] = 2
acc: 3
v[2] = 3
acc: 6
v[3] = 4
acc: 10
v[4] = 5
acc: 15
v[5] = -1.08671e-311
acc: 15
3 

```

–£–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ, –Ω–æ –æ—Ç–≤–µ—Ç –≤–Ω–µ–∑–∞–ø–Ω–æ —Å—Ç–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º! –û–¥–Ω–∞–∫–æ –æ—à–∏–±–∫–∞ –≤—Å—ë —Ä–∞–≤–Ω–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞: –º—ã –ø—Ä–∏–±–∞–≤–ª—è–µ–º –ª–∏—à–Ω–µ–µ —Å–ª–∞–≥–∞–µ–º–æ–µ `v[5]`, –∫–æ—Ç–æ—Ä–æ–µ –≤–æ–æ–±—â–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –≤–µ–∫—Ç–æ—Ä–µ –∏ –∏–º–µ–µ—Ç —Å—Ç—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

–ú—ã –æ–±—Ä–∞—Ç–∏–ª–∏—Å—å –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —ç–ª–µ–º–µ–Ω—Ç—É –≤–µ–∫—Ç–æ—Ä–∞ –∏ –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ, –Ω–æ –¥–∞–∂–µ –≤ —Ä—è–¥–µ —Å–ª—É—á–∞–µ–≤ —É–≤–∏–¥–µ–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç. –ó–Ω–∞—á–∏—Ç, `operator []` –¥–ª—è –≤–µ–∫—Ç–æ—Ä–∞ –Ω–µ –∏–º–µ–µ—Ç –Ω–∏–∫–∞–∫–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –æ—à–∏–±–æ–∫. –°–¥–µ–ª–∞–Ω–æ —ç—Ç–æ –∏–∑ –ø—Ä–∏–Ω—Ü–∏–ø–∞ –Ω—É–ª–µ–≤–æ–≥–æ –æ–≤–µ—Ä—Ö–µ–¥–∞: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω—É —Å–æ–∑–¥–∞–≤–∞–ª–∞ –±—ã —É—Å–ª–æ–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥. –¢–∞–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, –∫–∞–∫ –≤—ã –∑–Ω–∞–µ—Ç–µ –∏–∑ —Ç–µ–º—ã –æ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∫–µ, –¥–æ–≤–æ–ª—å–Ω–æ –∑–∞—Ç—Ä–∞—Ç–Ω–∞ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞.

–ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –æ–±—Ä–∞—â–µ–Ω–∏–µ–º –∫ –≤–µ–∫—Ç–æ—Ä—É –≤—Å—Ç–∞–≤–∏—Ç—å `assert`, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–∞. –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `at`, –∫–æ—Ç–æ—Ä—ã–π —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –Ω–µ–≤–µ—Ä–Ω–æ–º—É –∏–Ω–¥–µ–∫—Å—É:


```cpp

template <class T>
double mean(const std::vector<T>& v) {
    T acc;

    for (size_t i = 0; i <= v.size(); ++i) {
        acc += v.at(i);
    }

    return static_cast<double>(acc) / v.size();
} 

```

–ü–æ—Å–∫–æ–ª—å–∫—É –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –º—ã –Ω–µ –ª–æ–≤–∏–º, –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å, —Å–æ–æ–±—â–∞—è –æ —Ç–æ–º, —á—Ç–æ –≤ –Ω–µ–π –µ—Å—Ç—å –±–∞–≥:

![image](https://pictures.s3.yandex.net/resources/Untitled_37_1605252044.png)

–í –∫–æ–Ω—Å–æ–ª–∏ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —Ç–∞–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:


```cpp

> g++ mean.cpp -o mean
> ./mean
Mean: terminate called after throwing an instance of 'std::out_of_range'
  what():  vector::_M_range_check: __n (which is 5) >= this->size() (which is 5)

```

This application has requested the Runtime to terminate it in an unusual way.
Please contact the application's support team for more information.` 

–û–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —ç–ª–µ–º–µ–Ω—Ç—É –≤–µ–∫—Ç–æ—Ä–∞, –∏ –¥–∞–∂–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –Ω–µ–∫–æ—Ç–æ—Ä—É—é –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫—É: –∏–Ω–¥–µ–∫—Å —ç–ª–µ–º–µ–Ω—Ç–∞, —Ä–∞–∑–º–µ—Ä –≤–µ–∫—Ç–æ—Ä–∞. –ù–æ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–Ω—è—Ç–Ω–æ –æ —Ç–æ–º, –≥–¥–µ –∏–º–µ–Ω–Ω–æ –±–∞–≥ –≤ –∫–æ–¥–µ.

–ß—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º–Ω–æ–µ –º–µ—Å—Ç–æ, —Å–æ–±–µ—Ä—ë–º –ø—Ä–æ–≥—Ä–∞–º–º—É —Å –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∏ –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏. –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏–º gdb –∏ –¥–æ–±–∞–≤–∏–º –∫–æ–º–∞–Ω–¥—É `break abort`, —á—Ç–æ–±—ã –æ—Ç–ª–∞–¥—á–∏–∫ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è. –ü–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –∫–æ–º–∞–Ω–¥–æ–π `bt` –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –º–µ—Å—Ç–∞ –æ—à–∏–±–∫–∏.


```cpp

> g++ mean.cpp -o mean -g -O0
> gdb mean
(gdb) break abort
Breakpoint 1 at 0x6144d595
(gdb) r
Mean:
Thread 1 hit Breakpoint 1, 0x000000006144d595 in msvcrt!abort ()
(gdb) bt
...
#8  0x0000000000402e38 in mean<double> (v=std::vector of length 5, capacity 5 = {...}) at mean.cpp:16
#9  0x0000000000401605 in main () at mean.cpp:25 

```

–í–æ—Å—å–º–æ–π —Ñ—Ä–µ–π–º –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏ ‚Äî —Ñ–∞–π–ª –∏ –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏.

–ö–∞–∫ –≤–∏–¥–∏—Ç–µ, –≤—ã—è–≤–ª—è—Ç—å –æ—à–∏–±–∫–∏ –≤—Ä—É—á–Ω—É—é –¥–æ–≤–æ–ª—å–Ω–æ —Å–ª–æ–∂–Ω–æ. –ù–∞–º –ø–æ–≤–µ–∑–ª–æ, —á—Ç–æ –º—ã –¥–æ–≥–∞–¥–∞–ª–∏—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `at` –≤ –Ω—É–∂–Ω–æ–º –º–µ—Å—Ç–µ.

# –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –º–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

–ó–∞–º–µ–Ω—è—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã `operator []` –Ω–∞ `at` –∏–ª–∏ –¥–æ–±–∞–≤–ª—è—Ç—å `assert` –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–π –ø—Ä–æ–±–ª–µ–º–Ω—ã–º –º–µ—Å—Ç–æ–º ‚Äî —É—Ç–æ–º–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –∞ –≥–ª–∞–≤–Ω–æ–µ, –º–æ–∂–Ω–æ —á—Ç–æ-–Ω–∏–±—É–¥—å –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∏–ª–∏ –Ω–µ —É—á–µ—Å—Ç—å. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –æ–±—Ä–∞—â–µ–Ω–∏–µ –ø–æ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –∏–Ω–¥–µ–∫—Å—É ‚Äî —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º.

–û–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —É–∂–µ –ø–æ–¥—É–º–∞–ª–∏ –æ –Ω–∞—Å –∏ –¥–æ–±–∞–≤–∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Å–∞–º—ã—Ö —Ä–∞–∑–Ω—ã—Ö –æ—à–∏–±–æ–∫. –≠—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ß—Ç–æ–±—ã –∏—Ö –≤–∫–ª—é—á–∏—Ç—å, –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä—è–¥ –º–∞–∫—Ä–æ—Å–æ–≤, –∑–∞–≤–∏—Å—è—â–∏—Ö –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫—É—é —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ.

-   **libstdc++.** –≠—Ç–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –æ–±—ã—á–Ω–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞ Linux –∏ Windows –¥–ª—è gcc, clang. –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–∞–∫—Ä–æ—Å—ã `_GLIBCXX_DEBUG` –∏ `_GLIBCXX_DEBUG_PEDANTIC`.
-   **libc++**. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ MacOS. –î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å `_LIBCPP_DEBUG=1`.
-   **Microsoft/STL**. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Visual Studio. –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤–∫–ª—é—á–∞—é—Ç—Å—è –º–∞–∫—Ä–æ—Å–æ–º `_DEBUG`, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

–î–æ–±–∞–≤–ª—è—Ç—å –º–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞. –ï—Å–ª–∏ –≤—ã –Ω–µ —É–≤–µ—Ä–µ–Ω—ã, –∫–∞–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ‚Äî libstdc++ –∏–ª–∏ libc++ ‚Äî –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –æ–±–∞ –Ω–∞–±–æ—Ä–∞. –ü–æ—Å—Ç—É–ø–∏–º —Ç–∞–∫ –∏ –ø–æ–ø—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–¥ —Å—Ä–µ–¥–Ω–µ–≥–æ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å –æ—à–∏–±–∫–æ–π:

```bash


> g++ mean.cpp -D_GLIBCXX_DEBUG -D_GLIBCXX_DEBUG_PEDANTIC -D_LIB_DEBUG=1
> ./mean
Mean: .../c++/debug/vector:424:error: attempt to subscript container with out-of-bounds index 5, but container only holds 5 elements.

Objects involved in the operation:
sequence "this" @ 0x0000000000406850 {
  type = 

```

–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø–∞–¥–∞–µ—Ç, —Å–æ–æ–±—â–∞—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: –∏–Ω–¥–µ–∫—Å —ç–ª–µ–º–µ–Ω—Ç–∞ –∏ —Ä–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞. –ü–æ–¥ Linux —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–≤–µ–¥–µ–Ω –ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤. –ß—Ç–æ–±—ã –Ω–∞–π—Ç–∏ —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏ –º–æ–∂–Ω–æ –æ–ø—è—Ç—å –∂–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è gdb —Å –∫–æ–º–∞–Ω–¥–æ–π `break abort`.

```bash

> g++ mean.cpp -D_GLIBCXX_DEBUG -D_GLIBCXX_DEBUG_PEDANTIC -D_LIB_DEBUG=1 -g -o mean
> gdb mean
...
(gdb) break abort
(gdb) r
...
Thread 1 received signal SIGSEGV, Segmentation fault.
0x000000006fc650d9 in ?? () from ...\bin\libstdc++-6.dll
(gdb) bt
...
#4  0x0000000000402e6f in mean<double> (v=std::__debug::vector of length 5, capacity 5 = {...})
    at mean.cpp:16
#5  0x0000000000401608 in main () at mean.cpp:25 

```

–ö–∞–∫ –∏ –≤ –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑, –æ—Ç–ª–∞–¥—á–∏–∫ –ø–æ–∫–∞–∑–∞–ª —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏: —Ñ–∞–π–ª mean.cpp —Å—Ç—Ä–æ–∫–∞ 16.

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —ç—Ç–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –≤ —Ç–æ–º, —á—Ç–æ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏ –Ω–µ –ø—Ä–∏—à–ª–æ—Å—å –Ω–∏–∫–∞–∫ –º–µ–Ω—è—Ç—å –∫–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã. –í —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –≤–µ–∫—Ç–æ—Ä—É –º–æ–≥—É—Ç –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è –≤ —Å–æ—Ç–Ω—è—Ö –∏ —Ç—ã—Å—è—á–∞—Ö —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, –∏ –∑–∞–º–µ–Ω—è—Ç—å –∏—Ö –≤—Å–µ –Ω–∞ `at` –±—ã–ª–æ –±—ã –∫—Ä–∞–π–Ω–µ —É—Ç–æ–º–∏—Ç–µ–ª—å–Ω–æ. –£–∂ —Ç–æ—á–Ω–æ —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—É —Ñ–ª–∞–≥–æ–≤ –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.

–û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç –æ–≤–µ—Ä—Ö–µ–¥ ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∏, –∑–∞–º–µ–¥–ª—è—é—â–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—É. –ü–æ—ç—Ç–æ–º—É –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –¥–ª—è —Å–±–æ—Ä–∫–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏, –∏–¥—É—â–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –ù–æ –ø—Ä–∏–º–µ—Ä –≤—ã—à–µ –Ω–µ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ª—É—á–∞–π, –∫–æ–≥–¥–∞ –æ–Ω–∏ –ø–æ–ª–µ–∑–Ω—ã. –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç –≤—ã—è–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏:

-   –∏—Ç–µ—Ä–∞—Ç–æ—Ä–æ–≤: —É–≤–µ–ª–∏—á–µ–Ω–∏–µ `end` –∏–ª–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–µ `begin`, —Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞–Ω–∏–µ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏;
-   –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤: –ø–æ–ª—É—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ `vector` –∏–ª–∏ `string`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞ –¥—Ä—É–≥–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, —Å–æ–∑–¥–∞–Ω–∏–µ `string` –∏–∑ –Ω—É–ª–µ–≤–æ–≥–æ —É–∫–∞–∑–∞—Ç–µ–ª—è.
-   –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –∏—Ç–µ—Ä–∞—Ç–æ—Ä–æ–≤, –Ω–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –≥–¥–µ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–º–ø–∞—Ä–∞—Ç–æ—Ä.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–∏–º–µ—Ä–∞ –∞–ª–≥–æ—Ä–∏—Ç–º `upper_bound`. –û–Ω –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–∑–¥–µ–ª—ë–Ω –∏—Å–∫–æ–º—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º –Ω–∞ –º–µ–Ω—å—à–∏–µ –∏ –±–æ–ª—å—à–∏–µ. –≠—Ç–æ —É—Å–ª–æ–≤–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω. –ü–æ–ø—Ä–æ–±—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `upper_bound`, –Ω–∞—Ä—É—à–∏–≤ —É—Å–ª–æ–≤–∏–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è:


```cpp

#include <algorithm>
#include <iostream>
#include <random>
#include <vector>

using namespace std;

int main() {
    vector v = {1, 81, 100, 50, 70, 30, 90, 200};
    auto iter = upper_bound(v.begin(), v.end(), 80);
    if (iter != v.end()) {
        cout << "Found element "s << *iter << endl;
    }
} 

```

–°–∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º —ç—Ç–æ—Ç —Ñ–∞–π–ª `find.cpp` –∏ –∑–∞–ø—É—Å—Ç–∏–º –µ–≥–æ:
```bash

> g++ find.cpp -o find -std=c++17
> ./find
Found element 90 
```

–ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–¥–∞–ª–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ —Å–æ–æ–±—â–∏–≤ –Ω–∏ –æ –∫–∞–∫–æ–π –æ—à–∏–±–∫–µ. –í —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ —Ç–∞–∫–æ–π –±–∞–≥ –∏—Å–∫–∞—Ç—å –±—ã–ª–æ –±—ã –∫—Ä–∞–π–Ω–µ —Å–ª–æ–∂–Ω–æ. –ù–æ –ø–æ–ø—Ä–æ–±—É–µ–º —Å–æ–±—Ä–∞—Ç—å —Å —É–ø–æ–º—è–Ω—É—Ç—ã–º–∏ –º–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º–∏:
```bash

> g++ find.cpp -o find -std=c++17 -D_GLIBCXX_DEBUG -D_GLIBCXX_DEBUG_PEDANTIC -D_LIB_DEBUG=1
> find
.../stl_algo.h:2084:error: elements in iterator range [__first, __last) are not partitioned by the value __val. 

```

–ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–µ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º.


# Address sanitizer

–ù–µ –≤—Å–µ –æ—à–∏–±–∫–∏ —Å–≤–æ–¥—è—Ç—Å—è –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏. –ò —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –Ω–µ –≤—Å–µ –∏–∑ –Ω–∏—Ö –º–æ–∂–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è –æ—Ç–ª–∞–¥–æ—á–Ω—ã–º–∏ –º–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º–∏.

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—ã –∏–º–µ—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –≤—ã–ø–æ–ª–Ω—è—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –≤ –∫–æ–¥–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã. –û–Ω–∏ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–∞–º–∏. –°–∞–Ω–∏—Ç–∞–π–∑–µ—Ä—ã –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –≤ —Ä–µ–∂–∏–º–µ —É—Å–∏–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –æ—à–∏–±–æ–∫.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –∏—â–µ—Ç –º–µ–¥–∏–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É:


```cpp

#include <algorithm>
#include <iostream>
#include <string>
#include <vector>

using namespace std;

const string& GetMedianString(vector<string> v) {
    nth_element(v.begin(), v.begin() + v.size() / 2, v.end());
    const string& mid = v[v.size() / 2];

    return mid;
}

int main() {
    vector<string> v = {"cat"s, "dog"s, "elephant"s, "monkey"s, "llama"s};
    const string& res = GetMedianString(v);
    cout << res << endl;
} 

```

–°–∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º –∏ –∑–∞–ø—É—Å—Ç–∏–º –ø—Ä–æ–≥—Ä–∞–º–º—É:

```bash

> g++ median.cpp -o median
> ./median
elephant 

```

–ù–∞ –ø–µ—Ä–≤—ã–π –≤–∑–≥–ª—è–¥ –≤—Å—ë —Ö–æ—Ä–æ—à–æ. –ù–æ –≤–∫–ª—é—á–∏–º Address sanitizer, –¥–æ–±–∞–≤–∏–≤ –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `-fsanitize=address`. –° —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–æ–º —É–¥–æ–±–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä Clang.
```BASH



> clang++ l5-sample_1-deleted_1.cpp -o median -fsanitize=address
> ./median 

```

–ü–æ–¥ Windows –±—ã–ª –±—ã —Ç–∞–∫–æ–π –∫–æ–¥:
```BASH



> clang++ l5-sample_1-deleted_1.cpp -o median.exe -fsanitize=address
> median 

```

–¢–µ–ø–µ—Ä—å —è–≤–Ω–æ —á—Ç–æ-—Ç–æ –∏–¥—ë—Ç –Ω–µ —Ç–∞–∫. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–¥–∞—ë—Ç –º–Ω–æ–≥–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:
```BASH



=================================================================
==13408==ERROR: AddressSanitizer: heap-use-after-free on address 0x1234164a0170 at pc 0x7ff74886eb9e bp 0x00350d3ef9e0 sp 0x00350d3efa28
READ of size 8 at 0x1234164a0170 thread T0
    #0 0x7ff74886eb9d  (...\median.exe+0x14000eb9d)
    #1 0x7ff748862a97  (...\median.exe+0x140002a97)
    #2 0x7ff7488618dc  (...\median.exe+0x1400018dc)
    #3 0x7ff7488bc4cf  (...\median.exe+0x14005c4cf)
    #4 0x7ff941a484d3  (C:\Windows\System32\KERNEL32.DLL+0x1800084d3)
    #5 0x7ff942dd1790  (C:\Windows\SYSTEM32\ntdll.dll+0x180051790)

0x1234164a0170 is located 80 bytes inside of 160-byte region [0x1234164a0120,0x1234164a01c0)
freed by thread T0 here:
... 

```

–ò–∑ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–∞ heap-use-after-free –≤–∏–¥–Ω–æ: –º—ã –ø–æ–ø—ã—Ç–∞–ª–∏—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–º—è—Ç—å –ø–æ—Å–ª–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–Ω–æ–≥–æ –¥–µ—Ç–∞–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã –¥–∞–ª–µ–∫–æ –Ω–µ –≤—Å–µ–≥–¥–∞, –Ω–æ –≤ –Ω–µ–π –Ω–µ —É–∫–∞–∑–∞–Ω–æ –≥–ª–∞–≤–Ω–æ–µ ‚Äî –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ.

–ú–æ–∂–Ω–æ –Ω–∞–¥–µ–ª–∏—Ç—å —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é —É–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ—á–Ω—É—é —Å—Ç—Ä–æ–∫—É –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–≤–µ–ª–∞ –∫ –æ—à–∏–±–∫–µ. –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ:

-   —Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É —Å –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π ‚Äî —Ñ–ª–∞–≥ `-g`;
-   –¥–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–∫–ª—é—á–∞—é—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –∑–∞—Ç—Ä—É–¥–Ω—è—é—â–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ –≤ –∫–æ–¥–µ: `-O1 -fno-omit-frame-pointer -fno-optimize-sibling-calls`;
-   –µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏–º–≤–æ–ª–∞–π–∑–µ—Ä ‚Äî —É—Ç–∏–ª–∏—Ç—É, –æ–ø—Ä–µ–¥–µ–ª—è—é—â—É—é –º–µ—Å—Ç–æ –≤ –∫–æ–¥–µ –ø–æ –∞–¥—Ä–µ—Å—É.

–î–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—É–Ω–∫—Ç–∞ **–ø–æ–¥ Windows** –∏–Ω–æ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∏–¥–∞—Ç—å –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `ASAN_SYMBOLIZER_PATH`. –≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∫–æ–º–∞–Ω–¥–æ–π `SET ASAN_SYMBOLIZER_PATH=1`. –°–∞–Ω–∏—Ç–∞–π–∑–µ—Ä —Å–æ–æ–±—â–∏—Ç: `Failed to use and restart external symbolizer!`, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –≤—ã–≤–µ–¥–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏.

**–ü–æ–¥ Linux –∏ MacOS** —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ –∫–æ–º–∞–Ω–¥—ã `llvm-symbolizer` –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã, –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø—É—Ç—å –∫ —Å–∏–º–≤–æ–ª–∞–π–∑–µ—Ä—É –∫–æ–º–∞–Ω–¥–æ–π `which llvm-symbolizer`. –ó–∞—Ç–µ–º –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –µ–≥–æ, –≤—ã–ø–æ–ª–Ω–∏–≤ –∫–æ–º–∞–Ω–¥—É `export ASAN_SYMBOLIZER_PATH=<–ø—É—Ç—å –∫ —Å–∏–º–≤–æ–ª–∞–π–∑–µ—Ä—É>`.

–¢–µ–ø–µ—Ä—å –≤—Å—ë –≥–æ—Ç–æ–≤–æ. –°–æ–±–∏—Ä–∞–µ–º –∑–∞–Ω–æ–≤–æ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º:


```bash

> clang++ median.cpp -o median -fsanitize=address -g -O1 -fno-omit-frame-pointer -fno-optimize-sibling-calls
> ./median 

```

–í—ã–≤–æ–¥ —Å—Ç–∞–ª –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ, —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ –Ω—ë–º —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ –∫–æ–¥–∞:
```BASH



=================================================================
==10424==ERROR: AddressSanitizer: heap-use-after-free on address 0x127d6dd20170 at pc 0x7ff74d0b7bf0 bp 0x008ccc8ff5c0 sp 0x008ccc8ff608
READ of size 8 at 0x127d6dd20170 thread T0
    #0 0x7ff74d0b7bef in std::basic_string<char,std::char_traits<char>,std::allocator<char> >::size C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.26.28801\include\xstring:3694
    #1 0x7ff74d0b20da in std::operator<<<char,std::char_traits<char>,std::allocator<char> > C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.26.28801\include\xstring:4653
    #2 0x7ff74d0b162e in main ...\median.cpp:18
    #3 0x7ff74d10107f in __scrt_common_main_seh ...\exe_common.inl:288
    #4 0x7ff941a484d3 in BaseThreadInitThunk+0x13 (C:\Windows\System32\KERNEL32.DLL+0x1800084d3)
    #5 0x7ff942dd1790 in RtlUserThreadStart+0x20 (C:\Windows\SYSTEM32\ntdll.dll+0x180051790)

0x127d6dd20170 is located 80 bytes inside of 160-byte region [0x127d6dd20120,0x127d6dd201c0)
freed by thread T0 here: 

```

–í–∏–¥–∏–º, —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –≤—ã–≤–æ–¥–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º `<<` –≤ —Å—Ç—Ä–æ–∫–µ 18 —Ñ–∞–π–ª–∞ `median.cpp`.

–í —á—ë–º –ø—Ä–∏—á–∏–Ω–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–π –æ—à–∏–±–∫–∏?

–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `res` –Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Å—ã–ª–∫–æ–π, –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –µ—ë —Ç–∏–ø –Ω–∞ `const string`.

–í—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ, —ç—Ç–æ –ª–æ–∂–Ω–æ–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–∞.

–§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —Å—Å—ã–ª–∫–µ. –ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–∏–ø –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ `string`.

–í–µ—Ä–Ω–æ!

–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `mid` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–ª—å–∑—è –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ. –ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–∏–ø `mid` –Ω–∞ `const string`.

–§—É–Ω–∫—Ü–∏—è `GetMedianString` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç –≤–µ–∫—Ç–æ—Ä–∞ `v`, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏. –°—Å—ã–ª–∫–∞ –±—É–¥–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —É–∂–µ —É–¥–∞–ª—ë–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç, –Ω–æ –º—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–ø—ã—Ç–∞–ª–∏—Å—å –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å. –≠—Ç–æ –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è. –¢–µ–º –æ–ø–∞—Å–Ω–µ–µ, —á—Ç–æ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –æ–Ω–∞ –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–µ –≤—ã–∑–≤–∞–ª–∞ –æ—à–∏–±–∫—É, –Ω–æ –¥–∞–∂–µ –ø–æ–∑–≤–æ–ª–∏–ª–∞ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç!

–û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –Ω–∞ –≤–µ—Ä–¥–∏–∫—Ç —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–∞ ‚Äî –æ–¥–Ω–æ –∏–∑ –ø–µ—Ä–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω –≤—ã–≤–æ–¥–∏—Ç. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –≤–µ—Ä–¥–∏–∫—Ç: heap-use-after-free. –û—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–ª–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤–µ–∫—Ç–æ—Ä –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ `GetMedianString` —Ö—Ä–∞–Ω–∏–ª —Å—Ç—Ä–æ–∫–∏ –≤ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç–∏, —Ç–æ –µ—Å—Ç—å –∫—É—á–µ. –í —Å–≤–æ—ë–º –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –≤–µ–∫—Ç–æ—Ä –æ—Å–≤–æ–±–æ–¥–∏–ª —ç—Ç—É –ø–∞–º—è—Ç—å, –Ω–æ –º—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—ã—Ç–∞–ª–∏—Å—å –µ—ë –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

–í —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–∫–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫–∏–µ –µ—â—ë –æ—à–∏–±–∫–∏ –º–æ–∂–µ—Ç –≤—ã—è–≤–∏—Ç—å ASAN.

# –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± –æ—à–∏–±–∫–∞—Ö

–°–∞–Ω–∏—Ç–∞–π–∑–µ—Ä ‚Äî –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã—è–≤–ª—è–µ—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã. –î–µ–ª–∞–µ—Ç –æ–Ω —ç—Ç–æ –Ω–µ –∑–∞ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫. –°–∞–Ω–∏—Ç–∞–π–∑–µ—Ä –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª—è—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É, –Ω–æ –æ–±—ã—á–Ω–æ –Ω–µ –±–æ–ª–µ–µ, —á–µ–º –≤ –¥–≤–∞ —Ä–∞–∑–∞.

–í –ø—Ä–æ—à–ª–æ–º —É—Ä–æ–∫–µ –≤—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∏ –æ–¥–∏–Ω –≤–∏–¥ –æ—à–∏–±–æ–∫ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø–æ—Å–ª–µ –µ—ë –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è. –ù–æ Address sanitizer –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–π—Ç–∏ –∏ –¥—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º—ã.

### –í—ã—Ö–æ–¥ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –¥–∏–∞–ø–∞–∑–æ–Ω–∞

–¢–∞–∫—É—é –æ—à–∏–±–∫—É –º—ã —É–∂–µ –∏—Å–∫–∞–ª–∏, –∏—Å–ø–æ–ª—å–∑—É—è –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –º–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è. –û–¥–Ω–∞–∫–æ –æ–Ω–∏ —Å—Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º —Å–ª—É—á–∞–µ ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ `operator []` —É –≤–µ–∫—Ç–æ—Ä–∞ –∏–ª–∏ `string`. –ï—Å–ª–∏ –æ–±—Ä–∞—â–∞–µ—Ç–µ—Å—å –ø–æ –∏–Ω–¥–µ–∫—Å—É —É–∫–∞–∑–∞—Ç–µ–ª—è, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å, –∞ –∑–Ω–∞—á–∏—Ç, –Ω–µ –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å –Ω–∏–∫–∞–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫:


```cpp

#include <iostream>
#include <vector>

using namespace std;

template <class T>
double mean(const std::vector<T>& v) {
    T acc;
    const T* v_ptr = v.data();

    for (size_t i = 0; i <= v.size(); ++i) {
        acc += v_ptr[i];
    }

    return static_cast<double>(acc) / v.size();
}

int main() {
    vector<int> v = {1, 2, 3, 4, 5};
    cout << "Mean: "s << mean(v) << endl;
} 

```

–ó–∞–ø—É—Å—Ç–∏–º —Å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–º–∏ –º–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º–∏:
```bash

> g++ mean.cpp -o median -D_GLIBCXX_DEBUG -D_GLIBCXX_DEBUG_PEDANTIC
> ./mean
Mean: 3 

```

–û—à–∏–±–∫–∞ –Ω–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è, —Ö–æ—Ç—è –≤—ã —É–∂–µ –∑–Ω–∞–µ—Ç–µ, —á—Ç–æ –æ–Ω–∞ –µ—Å—Ç—å. –ó–∞–ø—É—Å—Ç–∏–º —Ç–µ–ø–µ—Ä—å —Å —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–æ–º.
```BASH

> clang++ mean.cpp -o mean -fsanitize=address -g
> ./mean
Mean: =================================================================
==12504==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x12580b1a0384 at pc 0x7ff704ce39d2 bp 0x00a1ac38f530 sp 0x00a1ac38f578
READ of size 4 at 0x12580b1a0384 thread T0
==12504==WARNING: Failed to use and restart external symbolizer!
    #0 0x7ff704ce39d1 in mean<int> .../mean.cpp:17
    #1 0x7ff704ce1288 in main .../mean.cpp:29
    #2 0x7ff704d46b3f in __scrt_common_main_seh ...\exe_common.inl:288
    #3 0x7ff941a484d3 in BaseThreadInitThunk+0x13 (C:\Windows\System32\KERNEL32.DLL+0x1800084d3)
    #4 0x7ff942dd1790 in RtlUserThreadStart+0x20 (C:\Windows\SYSTEM32\ntdll.dll+0x180051790) 

```

–í–∏–¥–∏–º –æ—à–∏–±–∫—É: heap-buffer-overflow. –û–Ω–∞ –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –º—ã –≤—ã—à–ª–∏ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –≤ –∫—É—á–µ.

–ù–æ —É—á—Ç–∏—Ç–µ, –∏–Ω–æ–≥–¥–∞ —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä –º–æ–∂–µ—Ç ¬´–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å¬ª –æ—à–∏–±–∫—É —Ç–∞–∫–æ–≥–æ —Ä–æ–¥–∞: –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤—ã –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–ª–∏ –º–µ—Å—Ç–æ –≤ –≤–µ–∫—Ç–æ—Ä–µ –º–µ—Ç–æ–¥–æ–º `reserve`:



```cpp
int main() {
    vector<int> v = {1, 2, 3, 4, 5};
    v.reserve(10);
    cout << "Mean: "s << mean(v) << endl;
} 
```


–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `mean` –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –µ—Å—Ç—å –≤—ã—Ö–æ–¥ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –≥—Ä–∞–Ω–∏—Ü –≤–µ–∫—Ç–æ—Ä–∞, —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä –º–æ–ª—á–∏—Ç: –æ–±—Ä–∞—â–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π, –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏. –¢–∞–∫—É—é –æ—à–∏–±–∫—É –º–æ–≥–ª–∏ –±—ã –≤—ã—è–≤–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –º–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.

–î—Ä—É–≥–æ–π –ø—Ä–∏–º–µ—Ä –ø–æ—Ö–æ–∂–µ–π –æ—à–∏–±–∫–∏ ‚Äî –≤—ã—Ö–æ–¥ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —Å—Ç–µ–∫–∞. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –æ–±—ã—á–Ω—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤ –∏–ª–∏ `std::array`, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç–∏. –í–µ—Ä–¥–∏–∫—Ç —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–∞ –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –±—É–¥–µ—Ç: stack-buffer-overflow.

### –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–ª–∏ –¥–≤–æ–π–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

–£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —É–∫–∞–∑–∞—Ç–µ–ª—è ‚Äî —ç—Ç–æ –≤—Å–µ–≥–¥–∞ –æ—à–∏–±–∫–∞. –ß–∞—â–µ –≤—Å–µ–≥–æ –æ–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ –≤—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –≤—ã–∑–≤–∞—Ç—å `delete` –¥–ª—è —É–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ –ø–∞–º—è—Ç—å, –∫–æ—Ç–æ—Ä–∞—è —É–∂–µ –±—ã–ª–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∞ —Ä–∞–Ω–µ–µ.

–ü–æ–¥–æ–±–Ω–æ–µ –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —É–¥–∞–ª–µ–Ω–∏—è –≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ:


```cpp

class IntArray {
public:
    IntArray(int n)
        : ptr(new int[n]) {
    }
    ~IntArray() {
        delete[] ptr;
    }

private:
    int* ptr;
};

int main() {
    IntArray a1(5);
    IntArray a2(a1);
} 

```

–î–≤–∞ –æ–±—ä–µ–∫—Ç–∞ `IntArray` –±—É–¥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å `ptr` –∏ –æ–±–∞ –ø–æ–ø—ã—Ç–∞—é—Ç—Å—è –µ–≥–æ —É–¥–∞–ª–∏—Ç—å.

–°–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –≤–µ—Ä–Ω–æ!

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º–∞, –∫–æ–Ω–µ—á–Ω–æ, —É–ø–∞–¥—ë—Ç, –Ω–æ –Ω–µ –≤—ã–¥–∞—Å—Ç –Ω–∏–∫–∞–∫–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è. –û–¥–Ω–∞–∫–æ –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å Address Sanitizer, —Å–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –≤–ø–æ–ª–Ω–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º:

```BASH

> clang++ array.cpp -fsanitize=address -g -o array -std=c++17
> ./array
=================================================================
==9480==ERROR: AddressSanitizer: attempting double-free on 0x11f2529a0370 in thread T0:
==9480==WARNING: Failed to use and restart external symbolizer!
    #0 0x7ff793c7381d in operator delete[] ...\asan\asan_new_delete.cpp:163
    #1 0x7ff793c312ca in IntArray::~IntArray ...\array.cpp:5
    #2 0x7ff793c31151 in main ...\array.cpp:15
    #3 0x7ff793c748d7 in __scrt_common_main_seh ...\exe_common.inl:288
.... 

```

–°–æ–æ–±—â–µ–Ω–∏–µ attempting double-free —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—É.

–ï—â—ë –æ–¥–∏–Ω –ø—Ä–∏–º–µ—Ä –ø–æ—Ö–æ–∂–µ–π –æ—à–∏–±–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ –ø—ã—Ç–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å –ø–∞–º—è—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–æ–±—â–µ –Ω–µ –±—ã–ª–∞ –≤—ã–¥–µ–ª–µ–Ω–∞.

–ü—Ä–∏–º–µ—Ä:


```cpp

#include <iostream>

using namespace std;

struct Point {
    int x;
    int y;
};

class PointHolder {
public:
    PointHolder(Point* pt)
        : pt_(pt) {
    }
    ~PointHolder() {
        delete pt_;
    }
    void Print() const {
        cout << "("s << pt_->x << ", "s << pt_->y << ")"s << endl;
    }

private:
    Point* pt_;
};

int main() {
    {
        PointHolder holder(new Point{10, 15});
        holder.Print();
    }  // OK
    {
        Point pt{10, 15};
        PointHolder holder(&pt);
        holder.Print();
    }  // –æ—à–∏–±–∫–∞: –ø–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å –≤ —Å—Ç–µ–∫–µ
} 

```

–í–µ—Ä–¥–∏–∫—Ç —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–∞: bad-free. –¢–æ –∂–µ —Å–∞–º–æ–µ –¥–ª–∏–Ω–Ω–æ: attempting free on address which was not malloc()-ed.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–µ–∫–∞ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è

–í –ø—Ä–æ—à–ª–æ–º —É—Ä–æ–∫–µ –≤—ã –≤–∏–¥–µ–ª–∏, –∫–∞–∫ –≤–æ–∑–≤—Ä–∞—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–µ use-after-free. –í —Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏–ª—Å—è –≤ –∫—É—á–µ. –í–æ–∑–º–æ–∂–µ–Ω –∏ –¥—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç:



```cpp
#include <iostream>
#include <tuple>

using namespace std;

auto GetTuple(int x, int y) {
    return tie(x, y);
}

int main() {
    auto [x, y] = GetTuple(10, 15);
    cout << x << ' ' << y << endl;
    return 0;
} 

```

–ö–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É –ø—Ä–æ–≥—Ä–∞–º–º—É –Ω—É–∂–Ω–æ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `-std=c++17`, –ø–æ—Å–∫–æ–ª—å–∫—É –≤ –Ω–µ–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ C++17.

–§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã, —Ä–∞–∑–º–µ—â—ë–Ω–Ω—ã–µ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö —Ñ—É–Ω–∫—Ü–∏–∏ `x` –∏ `y`, –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å `tie` –Ω–∞ `tuple`.

`x` –∏ `y` –∏–∑ `main` –±—É–¥—É—Ç –∏–º–µ—Ç—å –≤—ã–≤–µ–¥–µ–Ω–Ω—ã–π —Ç–∏–ø `int&`. –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Å–≤–æ–∏ –∞—Ä–≥—É–º–µ–Ω—Ç—ã: `x` –∏ `y`, –Ω–æ –ø–æ—Å–ª–µ –µ—ë –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç—ã —É–¥–∞–ª—è—Ç—Å—è, –∫–∞–∫ –∏ –¥—Ä—É–≥–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∏ —Å—Å—ã–ª–∫–∞ –±—É–¥–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –≤–Ω–∏–∫—É–¥–∞. –í–µ—Ä–¥–∏–∫—Ç —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–∞ stack-use-after-return. –ù–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —ç—Ç–æ–π –æ—à–∏–±–∫–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `ASAN_OPTIONS=detect_stack_use_after_return=1`. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Å–µ–∞–Ω—Å–∞ –∏ —Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –ø–æ–¥ Windows –º–æ–∂–Ω–æ —Ç–∞–∫:

```BASH

> SET ASAN_OPTIONS=detect_stack_use_after_return=1
> clang++ tuple.cpp -o tuple.exe -std=c++17 -fsanitize=address -g -O1 -fno-omit-frame-pointer -fno-optimize-sibling-calls
> tuple 

```

–ü–æ–¥ Linux –∏ MacOS:

```BASH

> export ASAN_OPTIONS=detect_stack_use_after_return=1
> clang++ tuple.cpp -o tuple -std=c++17 -fsanitize=address -g -O1 -fno-omit-frame-pointer -fno-optimize-sibling-calls
> ./tuple 

```

–û—à–∏–±–∫–æ–π —Ç–∞–∫–∂–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏, –∑–∞–Ω–∏–º–∞–µ–º–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã—à–ª–∞ –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —ç—Ç–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π. –í–µ—Ä–¥–∏–∫—Ç —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–∞ –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ: stack-use-after-scope.

–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≥—Ä–∞–º–º—ã:


```cpp

#include <functional>
#include <iostream>
using namespace std;

bool IsPrime(int x) {
    // —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å x –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç—É
    // –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ —á–∏—Å–ª–∞ –¥–æ –∫–æ—Ä–Ω—è –∏–∑ x
    for (int i = 2; i * i <= x; ++i) {
        if (x % i == 0) {
            return false;
        }
    }

    return true;
}

int main() {
    // function –∏–∑ <functional> –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—ä–µ–∫—Ç, 
    // –≤–µ–¥—É—â–∏–π —Å–µ–±—è –ø–æ–¥–æ–±–Ω–æ —Ñ—É–Ω–∫—Ü–∏–∏, –∏ –≤—ã–∑—ã–≤–∞—Ç—å –µ–≥–æ. –ù–∞–ø—Ä–∏–º–µ—Ä, –ª—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏—é.
    // –í –∫–∞—á–µ—Å—Ç–≤–µ —à–∞–±–ª–æ–Ω–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –Ω—É–∂–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
    function<int(int)> mult_prime;
    static const int N = 100'000;

    // –ú–µ–∂–¥—É —á–∏—Å–ª–∞–º–∏ N –∏ 2N –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å –ø—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ.
    // –ù–∞–π–¥—ë–º —Å–∞–º–æ–µ –±–æ–ª—å—à–æ–µ –∏–∑ –Ω–∏—Ö –≤ —Ü–∏–∫–ª–µ.
    for (int i = N; i < 2 * N; ++i) {
        if (IsPrime(i)) {
            mult_prime = [&](int x) {
                return x * i;
            };
        }
    }

    // mult_prime –¥–æ–ª–∂–Ω–∞ —É–º–Ω–æ–∂–∞—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç –Ω–∞ –Ω–∞–π–¥–µ–Ω–Ω–æ–µ –ø—Ä–æ—Å—Ç–æ–µ —á–∏—Å–ª–æ
    cout << mult_prime(100) << endl;
} 

```

–ü–æ—Å–∫–æ–ª—å–∫—É –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `i`, —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –≤ –ª—è–º–±–¥–∞-—Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ, –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–∏–∫–ª–∞, –ø—Ä–æ–≥—Ä–∞–º–º–∞, –≤—ã–∑—ã–≤–∞—é—â–∞—è —ç—Ç—É –ª—è–º–±–¥–∞ —Ñ—É–Ω–∫—Ü–∏—é, –æ—à–∏–±–æ—á–Ω–∞. –ï—Å–ª–∏ —Å–æ–±–∏—Ä–∞—Ç—å –±–µ–∑ —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–∞, –ø—Ä–æ–≥—Ä–∞–º–º–∞, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è, –Ω–æ —É–º–Ω–æ–∂–∞—Ç—å –Ω–µ –Ω–∞ —Ç–æ —á–∏—Å–ª–æ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –º—ã —Ö–æ—Ç–µ–ª–∏. –° —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–æ–º –æ—à–∏–±–∫–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–æ–π: stack-use-after-scope.

### –û–±—Ä–∞—â–µ–Ω–∏–µ –ø–æ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É —É–∫–∞–∑–∞—Ç–µ–ª—é

–£–∫–∞–∑–∞—Ç–µ–ª–∏ –ø—Ä–∏—è—Ç–Ω—ã —Ç–µ–º, —á—Ç–æ —É–∂–µ –≤–∫–ª—é—á–∞—é—Ç –≤ —Å–µ–±—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `optional` ‚Äî –∏–º–µ—é—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `nullptr`, –æ–∑–Ω–∞—á–∞—é—â–µ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∞–¥—Ä–µ—Å—É. –û–¥–Ω–∞–∫–æ –µ—Å–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –≤ –∫–∞–∫–æ–π-—Ç–æ –º–æ–º–µ–Ω—Ç –Ω–µ –ø–æ–¥—É–º–∞–ª, —á—Ç–æ —É–∫–∞–∑–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω—É–ª–µ–≤—ã–º, –∏ –ø–æ–ø—ã—Ç–∞–ª—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –ø–æ –Ω–µ–º—É, –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç –æ—à–∏–±–∫–∞. –ü–æ—Ö–æ–∂–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç, –µ—Å–ª–∏ –∞–¥—Ä–µ—Å –≤–æ–æ–±—â–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π: –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–≥–¥–∞ –≤—ã –∑–∞–±—ã–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä:



```cpp
#include <algorithm>
#include <iostream>

using namespace std;

int MyMin(const int* l, const int* r) {
    if (l == nullptr) {
        return *r;
    }

    return min(*l, *r);
}

int main() {
    int x = 5, y = 10;
    cout << MyMin(&x, &y) << endl;
    cout << MyMin(nullptr, &y) << endl;
    cout << MyMin(&x, nullptr) << endl;
} 

```

–í—ã–≤–æ–¥ —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–∞ —Å–æ–æ–±—â–∞–µ—Ç –æ–± –æ—à–∏–±–∫–µ access-violation on unknown address:

```BASH

=================================================================
==16200==ERROR: AddressSanitizer: access-violation on unknown address 0x000000000000 (pc 0x7ff76228141c bp 0x00c78c6ffc80 sp 0x00c78c6ffae0 T0)
==16200==The signal is caused by a READ memory access.
==16200==Hint: address points to the zero page.
    #0 0x7ff76228141b in std::min<int> ...\include\algorithm:5393
    #1 0x7ff762281096 in MyMin ...\badptr.cpp:11
    #2 0x7ff76228130b in main ...\badptr.cpp:18
... 

```

### –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏

–£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ –ø–∞–º—è—Ç—å –±—ã–ª–∞ –≤—ã–¥–µ–ª–µ–Ω–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π `new`, –Ω–æ –∑–∞—Ç–µ–º –Ω–µ —É–¥–∞–ª–µ–Ω–∞ –≤—ã–∑–æ–≤–æ–º `delete`. –≠—Ç–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–∞—è –æ—à–∏–±–∫–∞, –∫–æ—Ç–æ—Ä—É—é –¥–æ–≤–æ–ª—å–Ω–æ —Ç—Ä—É–¥–Ω–æ –≤—ã—è–≤–∏—Ç—å. –¢–∞–∫–∏–µ –æ—à–∏–±–∫–∏ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ Address sanitizer, –Ω–æ –∫ —Å–æ–∂–∞–ª–µ–Ω–∏—é, —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ–∫–∞ —á—Ç–æ —Ç–æ–ª—å–∫–æ –ø–æ–¥ Linux –∏–ª–∏ MacOS. –ß—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å —ç—Ç—É –æ–ø—Ü–∏—é, –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `ASAN_OPTIONS=detect_leaks=1`, –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `-fsanitize=leak` –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ç–∞–∫–æ–π –ø—Ä–∏–º–µ—Ä:


```cpp

class IntArray {
public:
    IntArray()
        : ptr(nullptr) {
    }
    IntArray(int n)
        : ptr(new int[n]) {
    }
    ~IntArray() {
        delete[] ptr;
    }

private:
    int* ptr;
};

int main() {
    IntArray a1(5);
    IntArray a2;
    a1 = a2;
} 
```

–ü—Ä–∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–∏ `a1 = a2` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å—Ç–∏—Ä–∞–Ω–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª—è –∏–∑ `a1`, –≤ –∏—Ç–æ–≥–µ, –æ–Ω –Ω–µ –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω

–í–æ–∑–Ω–∏–∫–∞–µ—Ç —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏.

–ó–∞–ø—É—Å—Ç–∏–º –ø–æ–¥ —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–æ–º:

```BASH

> clang++ leak.cpp -fsanitize=leak -g
> ./a.out 

=================================================================
==24449==ERROR: LeakSanitizer: detected memory leaks

Direct leak of 20 byte(s) in 1 object(s) allocated from:
    #0 0x40d978 in operator new[](unsigned long) (.../a.out+0x40d978)
    #1 0x43262a in IntArray::IntArray(int) .../leak.cpp:4:27
    #2 0x432585 in main .../leak.cpp:14:14
    #3 0x7fd73ffeebf6 in __libc_start_main /build/glibc-S7xCS9/glibc-2.27/csu/../csu/libc-start.c:310

```

SUMMARY: LeakSanitizer: 20 byte(s) leaked in 1 allocation(s).` 

–í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–µ–Ω. –û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∞–∫ —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ, –≥–¥–µ –±—ã–ª–∞ –≤—ã–¥–µ–ª–µ–Ω–∞ –ø–∞–º—è—Ç—å, —Ç–∞–∫ –∏ —Ä–∞–∑–º–µ—Ä –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞. –ú—ã –≤—ã–¥–µ–ª—è–ª–∏ –ø—è—Ç—å –æ–±—ä–µ–∫—Ç–æ–≤ `int` –ø–æ —á–µ—Ç—ã—Ä–µ –±–∞–π—Ç–∞, –≤—Å–µ–≥–æ 20 –±–∞–π—Ç, –∫–∞–∫ –∏ —Å–æ–æ–±—â–∏–ª —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏

–î–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —ç—Ç–æ–π –æ—à–∏–±–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Memory Sanitizer, –∫–æ—Ç–æ—Ä—ã–π –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ø–æ–¥ Linux. –í –ø—Ä–æ—à–ª—ã—Ö —É—Ä–æ–∫–∞—Ö –º—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∏ –ø—Ä–∏–º–µ—Ä –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–≥–æ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ. –í–µ—Ä–Ω—ë–º—Å—è –∫ –Ω–µ–º—É.

–ò—Å–ø—Ä–∞–≤–∏–º –æ—à–∏–±–∫—É, –∫–æ—Ç–æ—Ä—É—é –º—ã –≤—ã—è–≤–∏–ª–∏ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —É—Ä–æ–∫–∞—Ö, –Ω–æ –Ω–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ç–µ—Å—Ç–æ–≤ —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã–π –≤–µ–∫—Ç–æ—Ä:


```cpp

#include <iostream>
#include <vector>

using namespace std;

template <class T>
double mean(const std::vector<T>& v) {
    T acc;
    const T* v_ptr = v.data();

    for (size_t i = 0; i < v.size(); ++i) {
        acc += v_ptr[i];
    }

    return static_cast<double>(acc) / v.size();
}

int main() {
    vector<int> v = {1, 2, 3, 4, 5};
    cout << "Mean: "s << mean(v) << endl;
} 

```

–ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º:

```BASH

> g++ mean.cpp -o mean
> ./mean
Mean: 6555.2 

```

–ù–µ–ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–Ω—ã–π –æ—Ç–≤–µ—Ç. –ó–Ω–∞—á–∏—Ç, –≤ –Ω–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ –µ—Å—Ç—å –µ—â—ë –∫–∞–∫ –º–∏–Ω–∏–º—É–º –æ–¥–Ω–∞ –æ—à–∏–±–∫–∞.

–ó–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `acc` –Ω–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ. –í –Ω–µ–π –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –∫–∞–∫–æ–π-—Ç–æ –º—É—Å–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Ç–≤–µ—Ç.

–ö –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é `acc`, –∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ, –º—ã –ø—Ä–∏–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –≤–µ–∫—Ç–æ—Ä–∞, –ø–æ–ª—É—á–∞—è –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

–ï—Å–ª–∏ –≤–∫–ª—é—á–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∫–ª—é—á–æ–º `-Wall`, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä —Å–º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ —ç—Ç—É –æ—à–∏–±–∫—É —É–∂–µ –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –û–¥–Ω–∞–∫–æ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞. –ü–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å –µ—ë —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–æ–º.

–ó–∞–ø—É—Å—Ç–∏–º —ç—Ç—É –ø—Ä–æ–≥—Ä–∞–º–º—É, —Å–æ–±—Ä–∞–≤ –µ—ë —Å `-fsanitize=memory`:

```BASH

> clang++ mean.cpp -o mean -fsanitize=memory -g
> ./mean
Uninitialized bytes in __interceptor_memcmp at offset 168 inside [0x7fff5bd922a0, 256)
==24619==WARNING: MemorySanitizer: use-of-uninitialized-value
    #0 0x7f45ff7b9f6b in std::ctype<char>::_M_widen_init() const (/usr/lib/x86_64-linux-gnu/libstdc++.so.6+0xb8f6b)
    #1 0x7f45ff815ae7 in std::ostream& std::ostream::_M_insert<double>(double) (/usr/lib/x86_64-linux-gnu/libstdc++.so.6+0x114ae7)
    #2 0x49734d in main .../mean.cpp:20:22
    #3 0x7f45fe750bf6 in __libc_start_main /build/glibc-S7xCS9/glibc-2.27/csu/../csu/libc-start.c:310
    #4 0x41b229 in _start (.../mean+0x41b229)

SUMMARY: MemorySanitizer: use-of-uninitialized-value (/usr/lib/x86_64-linux-gnu/libstdc++.so.6+0xb8f6b) in std::ctype<char>::_M_widen_init() const
Exiting 

```

–°–∞–Ω–∏—Ç–∞–π–∑–µ—Ä –Ω–µ –ø–æ–∫–∞–∑–∞–ª —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –æ—à–∏–±–∫–∏ ‚Äî –æ–ø–µ—Ä–∞—Ü–∏—é `+=`, –≤ –∫–æ—Ç–æ—Ä–æ–π –≤–ø–µ—Ä–≤—ã–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å –Ω–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞–ª —Å—É—Ç—å.

–ü—Ä–∏–º–µ—Ä –≤ –æ—á–µ—Ä–µ–¥–Ω–æ–π —Ä–∞–∑ –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä –Ω–µ—Å–æ–≤–µ—Ä—à–µ–Ω–µ–Ω, –Ω–æ –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–µ–Ω. –ö–∞–∫ –∏ –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –º–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –æ–Ω –∑–∞–º–µ–¥–ª–∏—Ç –ø—Ä–æ–≥—Ä–∞–º–º—É: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –≤–µ—Ä—Å–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è. –ê–Ω–∞–ª–æ–≥ —Å–∞–Ω–∏—Ç–∞–π–∑–µ—Ä–∞ –ø–æ–¥ Windows —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –ø–∞–∫–µ—Ç–µ Visual Studio, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—è–≤–ª—è–µ—Ç –º–Ω–æ–≥–∏–µ –æ—à–∏–±–∫–∏ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ü—Ä–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Visual Studio –±—É–¥–µ—Ç —Ç–∞–∫–∂–µ –≤—ã—è–≤–ª—è—Ç—å —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏, –Ω–æ —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ —Ä–∞–º–∫–∏ –Ω–∞—à–µ–≥–æ –∫—É—Ä—Å–∞.

–ú—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–ø–æ—Å–æ–±–µ–Ω –≤—ã—è–≤–∏—Ç—å Address sanitizer. –í–ø–µ—Ä–µ–¥–∏ –≤–∞—Å –∂–¥—ë—Ç –Ω–µ–±–æ–ª—å—à–æ–π —Ç–µ—Å—Ç, –∏ –∏—Ç–æ–≥–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø–æ —ç—Ç–æ–π —Ç–µ–º–µ.
 



